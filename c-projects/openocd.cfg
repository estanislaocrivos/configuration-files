# =============================================================================
# OpenOCD Configuration for Embedded Development
# =============================================================================
# Usage:
#   openocd -f openocd.cfg
#
# This file is a template. Uncomment/adjust according to your hardware.
# =============================================================================

# -----------------------------------------------------------------------------
# Select debug interface (uncomment ONE)
# -----------------------------------------------------------------------------

# ST-Link V2 (common on Nucleo, Discovery boards)
source [find interface/stlink.cfg]

# ST-Link V2-1 (newer version)
# source [find interface/stlink-v2-1.cfg]

# ST-Link V3
# source [find interface/stlink-dap.cfg]

# J-Link
# source [find interface/jlink.cfg]

# CMSIS-DAP (generic, compatible with many debuggers)
# source [find interface/cmsis-dap.cfg]

# Black Magic Probe
# source [find interface/blackmagic.cfg]

# Raspberry Pi GPIO (for bare-metal debugging)
# source [find interface/raspberrypi-native.cfg]

# FTDI-based adapters
# source [find interface/ftdi/olimex-arm-usb-ocd-h.cfg]

# -----------------------------------------------------------------------------
# Transport speed
# -----------------------------------------------------------------------------

# Adapter speed in kHz (adjust according to your setup)
adapter speed 4000

# For low-power debugging or long cables, use lower speed:
# adapter speed 1000

# -----------------------------------------------------------------------------
# Select target/chip (uncomment ONE)
# -----------------------------------------------------------------------------

# === STM32 Series ===

# STM32F0 (Cortex-M0)
# source [find target/stm32f0x.cfg]

# STM32F1 (Cortex-M3) - Blue Pill, etc.
# source [find target/stm32f1x.cfg]

# STM32F2 (Cortex-M3)
# source [find target/stm32f2x.cfg]

# STM32F3 (Cortex-M4)
# source [find target/stm32f3x.cfg]

# STM32F4 (Cortex-M4) - Discovery, Nucleo F4xx
source [find target/stm32f4x.cfg]

# STM32F7 (Cortex-M7)
# source [find target/stm32f7x.cfg]

# STM32G0 (Cortex-M0+)
# source [find target/stm32g0x.cfg]

# STM32G4 (Cortex-M4)
# source [find target/stm32g4x.cfg]

# STM32H7 (Cortex-M7)
# source [find target/stm32h7x.cfg]

# STM32L0 (Cortex-M0+, ultra-low-power)
# source [find target/stm32l0.cfg]

# STM32L1 (Cortex-M3, ultra-low-power)
# source [find target/stm32l1.cfg]

# STM32L4 (Cortex-M4, ultra-low-power)
# source [find target/stm32l4x.cfg]

# STM32L5 (Cortex-M33, TrustZone)
# source [find target/stm32l5x.cfg]

# STM32U5 (Cortex-M33)
# source [find target/stm32u5x.cfg]

# STM32WB (Cortex-M4 + Cortex-M0, Bluetooth)
# source [find target/stm32wbx.cfg]

# STM32WL (Cortex-M4 + Cortex-M0, LoRa)
# source [find target/stm32wlx.cfg]

# === Nordic nRF Series ===

# nRF51 (Cortex-M0)
# source [find target/nrf51.cfg]

# nRF52 (Cortex-M4)
# source [find target/nrf52.cfg]

# === NXP/Freescale ===

# LPC1768 (Cortex-M3)
# source [find target/lpc1768.cfg]

# Kinetis K series (Cortex-M4)
# source [find target/klx.cfg]

# i.MX RT (Cortex-M7)
# source [find target/imxrt.cfg]

# === Atmel/Microchip SAM ===

# SAMD21 (Cortex-M0+)
# source [find target/at91samd21g18.cfg]

# SAME70 (Cortex-M7)
# source [find target/atsame70.cfg]

# === ESP32 (requires openocd-esp32) ===
# source [find target/esp32.cfg]

# === Raspberry Pi Pico (RP2040) ===
# source [find target/rp2040.cfg]

# === Generic Cortex-M ===
# source [find target/cortex_m.cfg]

# -----------------------------------------------------------------------------
# GDB server configuration
# -----------------------------------------------------------------------------

# GDB port (default 3333)
gdb_port 3333

# Telnet port for OpenOCD commands (default 4444)
telnet_port 4444

# TCL port (default 6666)
tcl_port 6666

# -----------------------------------------------------------------------------
# Reset configuration
# -----------------------------------------------------------------------------

# Reset type (adjust according to your hardware)
# - srst_only: System reset only
# - trst_only: JTAG TAP reset only
# - trst_and_srst: Both
# - none: No reset lines connected

reset_config srst_only srst_nogate

# Common alternatives:
# reset_config srst_nogate
# reset_config none

# -----------------------------------------------------------------------------
# Initialization commands
# -----------------------------------------------------------------------------

# Run on connect
init

# Reset and halt on startup
reset halt

# -----------------------------------------------------------------------------
# Custom commands (examples)
# -----------------------------------------------------------------------------

# Command to flash and reset
proc flash_and_reset {filename} {
    reset halt
    flash write_image erase $filename
    reset run
    echo "Flashed and running: $filename"
}

# Command to erase entire flash
proc mass_erase {} {
    reset halt
    flash erase_sector 0 0 last
    echo "Flash erased"
}

# Command to read memory
proc read_mem {addr len} {
    mem2array arr 8 $addr $len
    for {set i 0} {$i < $len} {incr i} {
        if {[expr $i % 16] == 0} {
            puts -nonewline [format "\n0x%08X: " [expr $addr + $i]]
        }
        puts -nonewline [format "%02X " $arr($i)]
    }
    puts ""
}

# -----------------------------------------------------------------------------
# SWO configuration (Serial Wire Output) for trace
# -----------------------------------------------------------------------------

# Uncomment to enable SWO trace
# tpiu config internal swo.log uart off 48000000

# -----------------------------------------------------------------------------
# RTT configuration (Real-Time Transfer) for SEGGER
# -----------------------------------------------------------------------------

# Requires RTT support in OpenOCD (recent versions)
# rtt setup 0x20000000 0x10000 "SEGGER RTT"
# rtt start
# rtt server start 9090 0

# -----------------------------------------------------------------------------
# Notes
# -----------------------------------------------------------------------------
#
# Useful OpenOCD commands (via telnet localhost 4444):
#
#   reset halt          - Reset and halt CPU
#   reset run           - Reset and run
#   halt                - Halt execution
#   resume              - Continue execution
#   step                - Execute one instruction
#   reg                 - Show registers
#   mdw <addr> [count]  - Read memory (32-bit words)
#   mww <addr> <value>  - Write memory (32-bit)
#   flash info 0        - Flash info
#   flash erase_sector 0 0 last  - Erase flash
#   flash write_image erase <file.elf>  - Flash firmware
#   exit                - Close OpenOCD
#
# =============================================================================
